# Aula 8 - Simulando um atraso na chamada Ã  API

Quando comeÃ§amos nossas refatoraÃ§Ãµes, lÃ¡ na aula 2, a primeira mudanÃ§a que fizemos foi substituir a verificaÃ§Ã£o de que o elemento de `Loading ...` era exibido e depois nÃ£o era mais exibido, para em vez disso, verificar que a requisiÃ§Ã£o correta ocorreu.

Mas e se quisÃ©ssemos testar este estado intermediÃ¡rio da funcionalidade de busca?

PodÃ­amos muito bem ter um cenÃ¡rio que fizesse exatamente o que era feito no `beforeEach`. Algo como o seguinte.

```js
it('shows a "Loading ..." state before showing the results', () => {
  cy.visit('/')

  cy.assertLoadingIsShownAndHidden()

  cy.get('.item').should('have.length', 20)
})
```

PorÃ©m, o que aconteceria se a requisiÃ§Ã£o fosse respondida mais rÃ¡pido que o tempo que o **Cypress** leva para verificar que o `Loading ...` estÃ¡ visÃ­vel?

Neste caso, terÃ­amos um teste _flaky_.

Eu nÃ£o gosto de testes _flaky_, e imagino que se vocÃª estÃ¡ fazendo este curso, nÃ£o deva gostar tambÃ©m.

> Testes _flaky_ sÃ£o aqueles que as vezes falham e outras passam, sem nenhuma mudanÃ§a no cÃ³digo da aplicaÃ§Ã£o ou do prÃ³prio teste.

Mais uma vez o `cy.intercept()` vem para nos salvar. ğŸ¦¸ğŸ¿â€â™‚ï¸

Escrevi um conteÃºdo chamado [**como simular a demora em uma requisiÃ§Ã£o com Cypress**](https://talkingabouttesting.com/2021/02/26/como-simular-a-demora-em-uma-requisicao-com-cypress/) e recomendo a leitura antes de seguir para o exercÃ­cio.

**Obs.:** ğŸ§™â€â™‚ï¸ Para os detalhes de implementaÃ§Ã£o do comando customizado `assertLoadingIsShownAndHidden`, acesso o arquivo `cypress/support/commands.js`.

## ExercÃ­cio

Escreva um cenÃ¡rio de teste chamado `shows a "Loading ..." state before showing the results`, onde vocÃª irÃ¡ simular um atraso de 1 segundo, para garantir que o teste serÃ¡ robusto.

___

Boa!

VÃ¡ para a [aula 9](./9.md) para modificar o relatÃ³rio de testes por um que faÃ§a mais o seu estilo.
